<!DOCTYPE html>
<html>
<head>
	<title>XamPlan Account</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<script src="./static/js/jquery-3.5.1.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
  	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
  	<link rel="icon" href="./static/img/xamplanicon.ico">
	
</head>
<style type="text/css">
	#heading{
		background-color: #EB4146;
	}
	#hard{
		color: red;
	}
	#med{
		color: orange;
	}
	#easy{
		color: lightgreen;
	}
	#hard_topic{
		background-color: rgba(253,0,0,0.3);
		color: black;
		margin: 5px;
		padding: 5px;
	}
	#med_topic{
		background-color: rgba(253,227,167,0.3);
		color: black;
		margin: 5px;
		padding: 5px;
	}
	#easy_topic{
		background-color: rgba(0,253,0,0.3);
		color: black;
		margin: 5px;
		padding: 5px;
	}
	#current_month{
		background-color: lightgreen;
	}

</style>
<script type="text/javascript">
	var data = JSON.parse('{{ data | safe }}');
	console.log('data: ',data)
	var topics = JSON.parse('{{ topics | safe }}');
	console.log('topics: ', topics.topics)
	var date = JSON.parse('{{ date | safe}}');
	console.log('date: ',date)

	function titleCase(str) {
	   var splitStr = str.toLowerCase().split(' ');
	   for (var i = 0; i < splitStr.length; i++) {
	       // You do not need to check if i is larger than splitStr length, as your for does that for you
	       // Assign it back to the array
	       splitStr[i] = splitStr[i].charAt(0).toUpperCase() + splitStr[i].substring(1);     
	   }
	   // Directly return the joined string
	   return splitStr.join(' '); 
	}

	function getTopicStatus(){

		var status = [0,0,0]  //[pending,completed,backlog]

		for(month in data['plan']){
			for(week in data['plan'][month]){
				for(difficulty_group in data['plan'][month][week]){
					for(topic in data['plan'][month][week][difficulty_group])
						topic_status = (data['plan'][month][week][difficulty_group][topic][1])
					if(topic_status == 'P') status[0] += 1
					if(topic_status == 'C') status[1] += 1
					if(topic_status == 'B') status[2] += 1

				}

			}
		}

		return status;
	}

	



	function openModal(id){
		document.getElementById('modal').style.display='block'
		document.getElementById('modal_heading').innerHTML = titleCase(id.split('_').join(' '))
		//console.log(data.plan[id])
		var weeks = ['week1','week2','week3','week4']

		for(w in weeks){

			if(weeks[w] in data.plan[id]){
				//add in week 1 div
				document.getElementById(weeks[w]).innerHTML = ''
				// console.log(id)
				// console.log("hard: ",data.plan[id][weeks[w]][0])	//hard
				// console.log("medium: ",data.plan[id][weeks[w]][1])	//medium
				// console.log("easy: ",data.plan[id][weeks[w]][2])	//easy

				var hard_div = '<div id="hard"><h2 style="color: black;">' + titleCase(weeks[w]) +'</h2><h3>Hard Topic</h3>'
				for(var x=0;x<data.plan[id][weeks[w]][0].length;x++){



					topic = '<div id="hard_topic">'

					if(date.month == id){

						if(data.plan[id][weeks[w]][0][x][1] == 'P'){
						checkbox = '<input class="w3-check w3-right w3-small" type="checkbox" id="topic_checkbox" value="' + data.plan[id][weeks[w]][0][x][0] + '|' + id + '|' + weeks[w]  +'" onchange="topicCheckBoxChanged(this)" name="topicCheckBox">'
						}

						if(data.plan[id][weeks[w]][0][x][1] == 'C'){
							checkbox = '<input class="w3-check w3-right w3-small" type="checkbox" id="topic_checkbox" value="' + data.plan[id][weeks[w]][0][x][0] + '|' + id + '|' + weeks[w]  + '" checked onchange="topicCheckBoxChanged(this)" name="topicCheckBox">'
						}

						topic += checkbox
					}

					//this is the topic name
					topic += '<span>Topic: </span> ' + titleCase(topics.topics[data.plan[id][weeks[w]][0][x][0]][0])
					//this is the topic subject
					topic += '<br><span>Subject: <span> ' + titleCase(topics.topics[data.plan[id][weeks[w]][0][x][0]][2])
					//this is the sub subject topic
					topic += '<br><span>Sub-Subject: <span> ' + titleCase(topics.topics[data.plan[id][weeks[w]][0][x][0]][3])
					topic += '</div>'
					hard_div += topic

					
				}
				hard_div += '</div>'


				var med_div = '<div id="med"><h3>Medium Topic</h3>'
				for(var x=0;x<data.plan[id][weeks[w]][1].length;x++){
					
					topic = '<div id="med_topic">'

					if(date.month == id){

						if(data.plan[id][weeks[w]][1][x][1] == 'P'){
						checkbox = '<input class="w3-check w3-right w3-small" type="checkbox" id="topic_checkbox" value="' + data.plan[id][weeks[w]][1][x][0] + '|' + id + '|' + weeks[w]  + '" onchange="topicCheckBoxChanged(this)" name="topicCheckBox">'
						}

						if(data.plan[id][weeks[w]][1][x][1] == 'C'){
							checkbox = '<input class="w3-check w3-right w3-small" type="checkbox" id="topic_checkbox" value="' + data.plan[id][weeks[w]][1][x][0] + '|' + id + '|' + weeks[w]  + '" checked onchange="topicCheckBoxChanged(this)" name="topicCheckBox">'
						}

						topic += checkbox
					}

					//this is the topic name
					topic += '<span>Topic: </span> ' + titleCase(topics.topics[data.plan[id][weeks[w]][1][x][0]][0])
					//this is the topic subject
					topic += '<br><span>Subject: <span> ' + titleCase(topics.topics[data.plan[id][weeks[w]][1][x][0]][2])
					//this is the sub subject topic
					topic += '<br><span>Sub-Subject: <span> ' + titleCase(topics.topics[data.plan[id][weeks[w]][1][x][0]][3])
					topic += '</div>'

					med_div += topic
				}
				med_div += '</div>'

				var easy_div = '<div id="easy"><h3>Easy Topic</h3>'
				for(var x=0;x<data.plan[id][weeks[w]][2].length;x++){

					topic = '<div id="easy_topic">'

					if(date.month == id){

						if(data.plan[id][weeks[w]][2][x][1] == 'P'){
						checkbox = '<input class="w3-check w3-right w3-small" type="checkbox" id="topic_checkbox" value="' + data.plan[id][weeks[w]][2][x][0] + '|' + id + '|' + weeks[w]  + '"onchange="topicCheckBoxChanged(this)" name="topicCheckBox">'
						}

						if(data.plan[id][weeks[w]][2][x][1] == 'C'){
							checkbox = '<input class="w3-check w3-right w3-small" type="checkbox" id="topic_checkbox" value="' + data.plan[id][weeks[w]][2][x][0] + '|' + id + '|' + weeks[w]  + '" checked onchange="topicCheckBoxChanged(this)" name="topicCheckBox">'
						}

						topic += checkbox
					}

					//this is the topic name
					topic += '<span>Topic: </span> ' + titleCase(topics.topics[data.plan[id][weeks[w]][2][x][0]][0])
					//this is the topic subject
					topic += '<br><span>Subject: <span> ' + titleCase(topics.topics[data.plan[id][weeks[w]][2][x][0]][2])
					//this is the sub subject topic
					topic += '<br><span>Sub-Subject: <span> ' + titleCase(topics.topics[data.plan[id][weeks[w]][2][x][0]][3])
					topic += '</div>'

					easy_div += topic
				}
				easy_div += '</div>'


				$('#' + weeks[w]).append(hard_div)
				$('#' + weeks[w]).append(med_div)
				$('#' + weeks[w]).append(easy_div)
			}
			else{
				document.getElementById(weeks[w]).innerHTML = ''
				$('#' + weeks[w]).append("<h2>" + titleCase(weeks[w]) +"</h2><h1>None</h1>")
			}
		}
	}

</script>
<body>

	<div id="heading" class="container-fluid p-2">
		<h1 id="heading_name1" class="display-2 text-white text-center d-none d-md-block" >hi</h1>
		<h1 id='heading_name2' class="display-4 text-white text-center d-block d-md-none"  >hi</h1>
	</div>
	
	<div  class="bg-light container  p-2" >
	
		<div class="col-4 w3-right">
			<a class="btn m-2 w3-right" style="color: white; background-color: #363B4D;"  href="{{ url_for('main') }}"> Home </a>
			<a class="btn m-2 w3-right" style="color: white; background-color: #363B4D;"  href="{{ url_for('logout') }}"> Logout </a>
			
		</div>

		<div class="container">
		  
		  <!-- Nav tabs -->
		  <ul class="nav nav-tabs" role="tablist">
		    <li class="nav-item">
		      <a class="nav-link active" style="color: #EB4146;" data-toggle="tab" href="#account">Account</a>
		    </li>
		    <li class="nav-item">
		      <a class="nav-link" style="color: #EB4146;" data-toggle="tab" href="#plan">Plan</a>
		    </li>
		    <li class="nav-item">
		      <a class="nav-link" style="color: #EB4146;" data-toggle="tab" href="#info">Info</a>
		    </li>
		  </ul>

		  <!-- Tab panes -->
		  <div class="tab-content">
		    
		    <div id="account" class="container tab-pane active"><br>
		      	<h2>DashBoard</h2>
				<br>
				<p style="text-align: center;"> Days until your Exam </p>
				<h1 id="timer" style="text-align: center; color: #EB4146;" class="display-4 w3-border"></h1>
				<p style="text-align: center;">Time's Running Out!</p>
				
				<div class=" row p-1">

					<div class="container  col-12 col-md-6 p-2">

						<div class="container p-2">
							<h3 class="container bg-info py-2 text-white" >Plan Progress</h3>
							<div id="bar">
							<canvas id="canvas1"  class="chartjs-render-monitor"></canvas>
							</div>
						</div>
						
					</div>

					<div class="container  col-12 col-md-2 p-2">

						<div class="container text-white p-2 text-center">
							<h3 class="container bg-warning py-2">Streak</h3>
							<div class="text-dark"> <h1 id='streak_count'> </h1><span style='font-size:6em;'>&#9889;</span></div>
						</div>
						
					</div>


					<div class="container  col-12 col-md-4 p-2">
						
						<div class="container p-2">
							<h3 class="container bg-primary py-2 text-white" >Motivation</h3>
						</div>

					</div>

				</div>

				<div class=" row p-1">

					<div class="container  col-12 col-md-6 p-2">

						<div class="container  p-2">
							<h3 class="container bg-success py-2 text-white" >Completed Topics</h3>
							<div id="completed_count" class="text-center text-success display-3">
							</div>
						</div>
						
					</div>


					<div class="container  col-12 col-md-6 p-2">
						
						<div class="container p-2">
							<h3 class="container bg-danger py-2 text-white" >Backlogs</h3>
							<div id="backlog_count" class="text-center text-danger display-3">
							</div>
						</div>

					</div>

				</div>

		    </div>


		    <div id="plan" class="container tab-pane fade"><br>
		      <h2 style="text-align:center;">Your Plan</h2>

				<div id="modal" class="w3-modal">
				  <div class="w3-modal-content w3-animate-top">
				    <div class="w3-container">
				      <span onclick="document.getElementById('modal').style.display='none'"
				      class="w3-button w3-display-topright">close &times;</span>
				      
				      <div class="p-2 m-2">
				      	<h3 id='modal_heading'></h3>

				      	<div class="w3-section w3-center">
							    <button class="w3-button w3-light-grey" onclick="plusDivs(-1)">❮ Prev Week</button>
							    <button class="w3-button w3-light-grey" onclick="plusDivs(1)">Next Week ❯</button>
						</div>
				      	
				      	<div class="w3-content" style="max-width:800px">
				      		<form>
								<div class="mySlides w3-animate-opacity"  style="width:100%" id="week1">
									week 1 
								</div>
								<div class="mySlides w3-animate-opacity"  style="width:100%" id="week2">
									week 2 
								</div>
								<div class="mySlides w3-animate-opacity"  style="width:100%" id="week3">
									week 3 
								</div>
								<div class="mySlides w3-animate-opacity"  style="width:100%" id="week4">
									week 4 
								</div>							
							</form>
						</div>

						<div class="w3-center"> 
							<button class="w3-button demo" id="slide_btn" onclick="currentDiv(1)">1</button>
							<button class="w3-button demo" id="slide_btn"onclick="currentDiv(2)">2</button> 
							<button class="w3-button demo" id="slide_btn"onclick="currentDiv(3)">3</button>
							<button class="w3-button demo"id="slide_btn" onclick="currentDiv(4)">4</button> 
						</div>
				      </div>
				      
				    </div>
				  </div>
				</div>

		      <div id='month_list' class="container p-2 row">
		      </div>
		    </div>

		    <div id=info class="container tab-pane fade"><br>
		      <h2>This is your Info</h2>
		      <div id="info_div">
		      </div>
		      <img id='curve_img' src='' alt='Your Curve' class="col-12 col-md-5">
		    </div>
		    
		  </div>
		</div>
		
	</div> 






</body>
<script type="text/javascript">
	console.log(data.name)
	
	//Name Heading and Streaks and completed and backlog count

	document.getElementById('heading_name1').innerHTML = data.name;
	document.getElementById('heading_name2').innerHTML = data.name;
	document.getElementById('streak_count').innerHTML = date.streak;
	var topicStatusCount = getTopicStatus()
	
	document.getElementById('completed_count').innerHTML = topicStatusCount[1]
	document.getElementById('backlog_count').innerHTML = topicStatusCount[2]


	document.getElementById('info_div')
	var college = '<h3><span style="color: #EB4146; font-size: 1.5em" >College</span>: ' + data.college + '</h3>'
	$('#info_div').append(college)
	var exam_name = '<h3><span style="color: #EB4146; font-size: 1.5em" >Exam</span>: ' + data.exam + '</h3>'
	$('#info_div').append(exam_name)
	var email_id = '<h3><span style="color: #EB4146; font-size: 1.5em" >Email</span>: ' + data.email + '</h3>'
	$('#info_div').append(email_id)
	var learning_curve = '<h3><span style="color: #EB4146; font-size: 1.5em" >Learning Curve</span>: ' + titleCase(data.curve) + '</h3>'
	$('#info_div').append(learning_curve)

	document.getElementById('curve_img').src = './static/img/' + data.curve + 'curve.png'


	//month Button Script

	for(key in data.plan){

		if (date.month == key){
			button = '<div class="col-12 col-md-6 "><button onclick="openModal(this.id)" id=' + key + ' class="m-2 w3-button w3-round-xxlarge container-fluid w3-green">' + titleCase(key.split('_').join(' ')) +'</button></div>'
		} else {
			button = '<div class="col-12 col-md-6 "><button onclick="openModal(this.id)" id=' + key + ' class="m-2 w3-button w3-round-xxlarge container-fluid w3-gray">' + titleCase(key.split('_').join(' ')) +'</button></div>'
		}
		
		$('#month_list').append(button)
		
	}


//CHARTS CREATION

	var ctx1 = document.getElementById('canvas1').getContext('2d');
	window.myChartRadar = new Chart(ctx1, {
		type: 'doughnut', 
		data: {											
		labels: ['Pending','Completed','Backlogs'],
		datasets: [{
			label: 'prices', 
			borderWidth: 2, 
			hoverBorderWidth: 10,
			hoverBorderColor: 'white' ,
			backgroundColor: ['lightgray','lightgreen','tomato'], 
			data: getTopicStatus(),
			borderColor: 'white',
			}]
		},									//The Default data
		labels: ['Pending','Completed','Backlogs'],
		datasets: [{
			label: 'prices', 
			borderWidth: 5, 
			hoverBorderWidth: 10, 
			backgroundColor: ['lightgray','lightgreen','tomato'], 
			data: [10,30,10],
			borderColor: 'black',
		}] ,
		options: {
			responsive: true,
			scales: {
		        xAxes: [{
		        	ticks: {
                		display: false
            		},
		            gridLines: {
		                display:false
		            }
		        }],
		        yAxes: [{
		        	ticks: {
                		display: false
            		},
		            gridLines: {
		                display:false
		            }   
		        }]
		    }, 
			legend: {
				position: 'top'
			}, 
			title: {
				display: false,
				text: 'Plan Progress'
			}
		}
	});


	function topicCheckBoxChanged(topicCheck){

		topicData = topicCheck.value.split('|');

		//The check topic state
		checkedTopicData = {
				'email' : data.email,
				'topicCode' : topicData[0],
				'topicMonth' : topicData[1],
				'topicWeek' : topicData[2],
				'topicState' : topicCheck.checked
		}

		console.log(checkedTopicData);

		///Make an AJAX Function to send this data to the back end and save it's state

		$.ajax({
	            url: '/send_checked_topics',
	            data: checkedTopicData,
	            type: 'POST',
	            success: function(response) {
	                console.log(response)
	               }
	    });
	}

	//Modal Slide Show 
	var slideIndex = 1;
	showDivs(slideIndex);

	function plusDivs(n) {
	  showDivs(slideIndex += n);
	}

	function currentDiv(n) {
	  showDivs(slideIndex = n);
	}

	function showDivs(n) {
	  var i;
	  var x = document.getElementsByClassName("mySlides");
	  var dots = document.getElementsByClassName("demo");
	  if (n > x.length) {slideIndex = 1}    
	  if (n < 1) {slideIndex = x.length}
	  for (i = 0; i < x.length; i++) {
	    x[i].style.display = "none";  
	  }
	  for (i = 0; i < dots.length; i++) {
	    dots[i].className = dots[i].className.replace(" w3-red", "");
	  }
	  x[slideIndex-1].style.display = "block";  
	  dots[slideIndex-1].className += " w3-red";
	}

	

	// Set the date we're counting down to
	var countDownDate = new Date("Feb 1, " + data.year + " 00:00:00").getTime();

	// Update the count down every 1 second
	var x = setInterval(function() {

	  // Get today's date and time
	  var now = new Date().getTime();

	  // Find the distance between now and the count down date
	  var distance = countDownDate - now;

	  // Time calculations for days, hours, minutes and seconds
	  var days = Math.floor(distance / (1000 * 60 * 60 * 24));
	  var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
	  var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
	  var seconds = Math.floor((distance % (1000 * 60)) / 1000);

	  // Display the result in the element with id="timer"
	  document.getElementById("timer").innerHTML = days + "d " + hours + "h "
	  + minutes + "m " + seconds + "s ";

	  // If the count down is finished, write some text
	  if (distance < 0) {
	    clearInterval(x);
	    document.getElementById("timer").innerHTML = "EXPIRED";
	  }
	}, 1000);


	
</script>
</html>